@using ClipCore.Core.Interfaces
@using ClipCore.Infrastructure.Services
@inject TenantContext TenantContext
@implements IDisposable

    <style>
        :root {
            /* Dark Mode Overrides (Default) */
            --accent-primary: @(TenantContext.Theme.DarkPrimary ?? "#06b6d4");
            --accent-secondary: @(TenantContext.Theme.DarkSecondary ?? "#ec4899");
            --bg-main: @(TenantContext.Theme.DarkBackground ?? "#0f1129");
            --bg-surface: @(TenantContext.Theme.DarkSurface ?? "#171936");
            --text-main: @(TenantContext.Theme.DarkText ?? "#ffffff");
            --btn-gradient-start: @(TenantContext.Theme.DarkBtnStart ?? "#0284c7");
            --btn-gradient-end: @(TenantContext.Theme.DarkBtnEnd ?? "#06b6d4");
            --brand-text-main: @(TenantContext.Theme.DarkBrandText ?? "#ffffff");
            
            /* Derived variables consuming the 1:1 mappings */
            --brand-accent-color: var(--accent-primary);
            @if (!string.IsNullOrEmpty(TenantContext.Theme.DarkSurface)) { <text>--bg-subtle: color-mix(in srgb, var(--bg-surface), var(--text-main) 5%);</text> }
            --accent-primary-dim: color-mix(in srgb, var(--accent-primary), transparent 90%);
            --accent-secondary-dim: color-mix(in srgb, var(--accent-secondary), transparent 90%);
            --accent-primary-gradient: linear-gradient(90deg, var(--btn-gradient-start) 0%, var(--btn-gradient-end) 100%);

            /* Functional Status Colors - Dark */
            --status-success: #10b981;
            --status-danger: #ef4444;
            --status-warning: #f59e0b;
            --status-success-dim: color-mix(in srgb, var(--status-success), transparent 90%);
            --status-danger-dim: color-mix(in srgb, var(--status-danger), transparent 90%);

            /* Syncing with existing variables for consistency */
            --border-active: var(--accent-primary);
            --bs-body-color: var(--text-main);
        }

        :root.light-theme {
            /* Light Mode Overrides */
            --accent-primary: @(TenantContext.Theme.LightPrimary ?? "#06b6d4") !important;
            --accent-secondary: @(TenantContext.Theme.LightSecondary ?? "#ec4899") !important;
            --bg-main: @(TenantContext.Theme.LightBackground ?? "#f8fafc") !important;
            --bg-surface: @(TenantContext.Theme.LightSurface ?? "#ffffff") !important;
            --text-main: @(TenantContext.Theme.LightText ?? "#0f172a") !important;
            --btn-gradient-start: @(TenantContext.Theme.LightBtnStart ?? "#0284c7") !important;
            --btn-gradient-end: @(TenantContext.Theme.LightBtnEnd ?? "#06b6d4") !important;
            --brand-text-main: @(TenantContext.Theme.LightBrandText ?? "#0f172a") !important;

            /* Derived variables consuming the 1:1 mappings */
            --brand-accent-color: var(--accent-primary) !important;
            @if (!string.IsNullOrEmpty(TenantContext.Theme.LightSurface)) { <text>--bg-subtle: color-mix(in srgb, var(--bg-surface), var(--text-main) 5%) !important;</text> }
            --accent-primary-dim: color-mix(in srgb, var(--accent-primary), transparent 90%) !important;
            --accent-secondary-dim: color-mix(in srgb, var(--accent-secondary), transparent 90%) !important;
            --accent-primary-gradient: linear-gradient(90deg, var(--btn-gradient-start) 0%, var(--btn-gradient-end) 100%) !important;

            /* Functional Status Colors - Light */
            --status-success: #059669 !important;
            --status-danger: #dc2626 !important;
            --status-warning: #d97706 !important;
            --status-success-dim: color-mix(in srgb, var(--status-success), transparent 90%) !important;
            --status-danger-dim: color-mix(in srgb, var(--status-danger), transparent 90%) !important;

            /* Syncing with existing variables for consistency */
            --border-active: var(--accent-primary) !important;
            --bs-body-color: var(--text-main) !important;
        }
    </style>

@code {
    [Inject] private ClipCore.Web.Services.StoreSettingsService StoreSettingsService { get; set; } = default!;

    protected override void OnInitialized()
    {
        StoreSettingsService.OnChange += HandleSettingsChange;
    }

    private void HandleSettingsChange()
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        StoreSettingsService.OnChange -= HandleSettingsChange;
    }
}
